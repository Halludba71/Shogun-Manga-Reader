{% load static %}
<html>
<head>
    {% block extra_head_content %}
    <!-- Currently using base.css replace with read.css later on -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/read.css' %}">
    {% endblock %}
    <link rel="shortcut icon" type="image/x-icon" href="{% static 'images/samurai.svg' %}" />
    <title>{{chapter.name}}</title>

</head>
<body>
    <div class="hoverToDisplay"></div>
    <header>
        <a href="javascript:history.back()" class="back">
            <img src="{% static 'images/back.png' %}" width="40" height="40" >
        </a>
        <h3>{{chapter.name}}</h3>
        <button class="setting-button" onclick="showSettings()">
            <img src="{% static 'images/setting.svg' %}" alt="">
        </button>
    </header>
    <main>
        <div class="settingsContainer">
            <div class="settings" id="settings">
                <button class="close-button" onclick="showSettings()">
                    <img src="{% static 'images/close-button.svg' %}" alt="">
                </button>
                <div class="reading-style">
                    <h3>Reading Style</h3>
                    <div class="reading-style-buttons" id="reading-style">
                        <button class="active left-to-right" id="left-to-right" onclick="LeftToRight()">
                            Left-to-right
                        </button>
                        <button class="right-to-left" id="right-to-left" onclick="RightToLeft()">
                            Right-to-left
                        </button>
                        <button class="vertical" id="vertical" onclick="vertical()">
                            Vertical
                        </button>
                        <button class="continuous-vertical" id="continuous-vertical" onclick="continuousVertical()">
                            Continuous Vertical
                        </button>
                    </div>
                </div>
                <div class="page-layout">
                    <h3>Page Layout</h3>
                    <div class="page-layout-buttons" >
                        <button class="single-page">
                            Single-Page
                        </button>
                        <button class="two-page">
                            Two-Page-Even
                        </button>
                        <button class="two-page-odd">
                            Two-Page-Odd
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- NO need to make this a base template since this will not include the side bar -->
        <div class="image-container" id="image-container" data-orientation="horizontal">
            {% for image in images %}  
            {% if forloop.counter0 == 0%}
            <div class="image">
                <img src="{{image}}">
            </div>
            
            {% else %}
            <div class="image hide">
                <img src="{{image}}">
            </div>
            {% endif %}
            {% endfor %}
        </div>
        
    </main>
    <script>
        var images = Array.from(document.getElementsByClassName("image"));
        var currentImage = 0;
        var length = images.length;
        var orientation = "left-to-right";

        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry =>{
                if((orientation == "continuous-vertical") || (orientation == "vertical")){
                    // if(entry.isIntersecting){
                    console.log(entries.targe)
                }
            })
        });

        images.forEach(image =>{
            observer.observe(image);
        })

        // window.onscroll = function() {
        //     Array.from(images).forEach(image => {
        //         console.log(inViewport(image))
        //     });
        // }

        function inViewport(image) {
            const rect = image.getBoundingClientRect();
            return (
            rect.top >= 0 &&
            rect.left >= 0 &&
            rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
            rect.right <= (window.innerWidth || document.documentElement.clientWidth)
            );
        }

        function showSettings() {
            var settings = document.getElementById("settings");
            if (settings.className == "settings"){
                settings.className = "settings show";
            } else if (settings.className == "settings show"){
                settings.className = "settings";
            }
        }

        function RightToLeft() {
            if (orientation != "right-to-left"){
                if (orientation == "left-to-right"){
                    images = images.reverse();
                    currentImage = length - currentImage - 1;
                    document.getElementById(orientation).className = orientation;
                    document.getElementById("right-to-left").className = "active right-to-left";
                    orientation = "right-to-left";
                } else {
                    document.getElementById(orientation).className = orientation;
                    document.getElementById("right-to-left").className = "active right-to-left";
                    orientation = "right-to-left";
                    images.forEach(image => {
                        image.className = "image hide"
                    });
                    images = images.reverse();
                    currentImage = length - currentImage - 1;
                    images[currentImage].className = "image"
                    var container = document.getElementById("image-container");
                    container.setAttribute("data-orientation", "horizontal");
                }
            }
        }

        function vertical(){
            if (orientation != "vertical"){
                if (orientation == "continuous-vertical"){
                    document.getElementById(orientation).className = orientation;
                    document.getElementById("vertical").className = "active vertical";
                    orientation = "vertical";
                    var container = document.getElementById("image-container");
                    container.setAttribute("data-orientation", "vertical");
                
                } else {
                    if (orientation == "right-to-left"){
                        images = images.reverse();
                        currentImage = length - currentImage - 1;
                    } 
                    document.getElementById(orientation).className = orientation;
                    document.getElementById("vertical").className = "active vertical";
                    orientation = "vertical";
                    images.forEach(image => {
                        image.className = "image"
                    });
                    var container = document.getElementById("image-container");
                    container.setAttribute("data-orientation", "vertical");
                }
            }
        }

        function continuousVertical(){
            if (orientation != "continuous-vertical"){
                if (orientation == "vertical"){
                    document.getElementById(orientation).className = orientation;
                    document.getElementById("continuous-vertical").className = "active continuous-vertical";
                    orientation = "continuous-vertical";
                    var container = document.getElementById("image-container");
                    container.setAttribute("data-orientation", "continuous-vertical");
                } else {
                    if (orientation == "right-to-left"){
                        images = images.reverse();
                        currentImage = length - currentImage - 1;

                    }
                    document.getElementById(orientation).className = orientation;
                    document.getElementById("continuous-vertical").className = "active continuous-vertical";
                    orientation = "continuous-vertical";
                    images.forEach(image => {
                        image.className = "image"
                    });
                    var container = document.getElementById("image-container");
                    container.setAttribute("data-orientation", "continuous-vertical");
                }
            }
        }

        function LeftToRight() {
            if (orientation != "left-to-right"){
                if (orientation != "vertical"){
                    images = images.reverse();
                    currentImage = length - currentImage - 1;
                    document.getElementById(orientation).className = orientation;
                    document.getElementById("left-to-right").className = "active left-to-right";
                    orientation = "left-to-right";
                } else {
                    document.getElementById(orientation).className = orientation;
                    document.getElementById("left-to-right").className = "active left-to-right";
                    orientation = "left-to-right";
                    images.forEach(image => {
                        image.className = "image hide"
                    });
                    images[currentImage].className = "image"
                    var container = document.getElementById("image-container");
                    container.setAttribute("data-orientation", "horizontal");
                }
            }
        }

        document.body.addEventListener('keydown', function(event) {
            const key = event.key;
            switch (key) {
                case "ArrowLeft":
                    if (orientation != "vertical"){
                        console.log('Left');
                        if (currentImage != 0){
                            images[currentImage].className = "image hide";
                            currentImage -= 1;
                            images[currentImage].className = "image";
                        }
                    }
                    break;
                case "ArrowRight":
                    if (orientation != "vertical"){
                        console.log('Right');
                        if (currentImage != length-1){
                            images[currentImage].className = "image hide";
                            currentImage += 1;
                            images[currentImage].className = "image";
                        }
                    }
                    break;
            }
        });

    </script>
</body>
</html>